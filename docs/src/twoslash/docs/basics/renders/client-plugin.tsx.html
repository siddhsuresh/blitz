<pre class="shiki light-plus twoslash lsp" style="background-color: #FFFFFF; color: #000000"><div class="language-id">tsx</div><div class='code-container'><code><div class='line'><span style="color: #008000">//@filename: src/custom-plugin/plugin.tsx</span></div><div class='line'><span style="color: #AF00DB">import</span><span style="color: #000000"> { </span><span style="color: #001080"><data-lsp lsp='(alias) function createClientPlugin&lt;TPluginOptions, TPluginExports extends object>(pluginConstructor: (options: TPluginOptions) => ClientPlugin&lt;TPluginExports>): (options: TPluginOptions) => ClientPlugin&lt;TPluginExports>&#10;import createClientPlugin' >createClientPlugin</data-lsp></span><span style="color: #000000"> } </span><span style="color: #AF00DB">from</span><span style="color: #000000"> </span><span style="color: #A31515">"blitz"</span></div><div class='line'><span style="color: #AF00DB">import</span><span style="color: #000000"> { </span><span style="color: #001080"><data-lsp lsp='(alias) type BlitzPage&lt;P = {}> = React.ComponentType&lt;P> &amp; {&#10;    getLayout?: ((component: JSX.Element) => JSX.Element) | undefined;&#10;    authenticate?: boolean | {&#10;        redirectTo?: string | RouteUrlObject | undefined;&#10;        role?: string | ... 1 more ... | undefined;&#10;    } | undefined;&#10;    suppressFirstRenderFlicker?: boolean | undefined;&#10;    redirectAuthenticatedTo?: RedirectAuthenticatedTo | ... 1 more ... | undefined;&#10;}&#10;import BlitzPage' >BlitzPage</data-lsp></span><span style="color: #000000"> } </span><span style="color: #AF00DB">from</span><span style="color: #000000"> </span><span style="color: #A31515">"@blitzjs/next"</span></div><div class='line'><span style="color: #AF00DB">import</span><span style="color: #000000"> { </span><span style="color: #001080"><data-lsp lsp='(alias) type ComponentProps&lt;T extends keyof JSX.IntrinsicElements | import("/home/siddharth/Documents/GitHub/siddhsuresh-blitz/node_modules/@types/react/index.d.ts").JSXElementConstructor&lt;any>> = T extends JSXElementConstructor&lt;infer P> ? P : T extends keyof JSX.IntrinsicElements ? JSX.IntrinsicElements[T] : {}&#10;import ComponentProps' >ComponentProps</data-lsp></span><span style="color: #000000">, </span><span style="color: #001080"><data-lsp lsp='(alias) type ComponentType&lt;P = {}> = ComponentClass&lt;P, any> | FunctionComponent&lt;P>&#10;import ComponentType' >ComponentType</data-lsp></span><span style="color: #000000"> } </span><span style="color: #AF00DB">from</span><span style="color: #000000"> </span><span style="color: #A31515">"react"</span></div><div class='line'>&nbsp;</div><div class='line'><span style="color: #0000FF">type</span><span style="color: #000000"> </span><span style="color: #267F99"><data-lsp lsp='type CustomPluginOptions = {}' >CustomPluginOptions</data-lsp></span><span style="color: #000000"> = {</span></div><div class='line'><span style="color: #000000">  </span><span style="color: #008000">// ... type definitions for options</span></div><div class='line'><span style="color: #000000">}</span></div><div class='line'>&nbsp;</div><div class='line'><span style="color: #0000FF">function</span><span style="color: #000000"> </span><span style="color: #795E26"><data-lsp lsp='function withCustomProvider&lt;TProps = any>(Page: ComponentType&lt;TProps> | BlitzPage&lt;TProps>): {&#10;    (props: ComponentProps&lt;any>): JSX.Element;&#10;    displayName: string;&#10;}' >withCustomProvider</data-lsp></span><span style="color: #000000">&lt;</span><span style="color: #267F99"><data-lsp lsp='(type parameter) TProps in withCustomProvider&lt;TProps = any>(Page: React.ComponentType&lt;TProps> | BlitzPage&lt;TProps>): {&#10;    (props: ComponentProps&lt;any>): JSX.Element;&#10;    displayName: string;&#10;}' >TProps</data-lsp></span><span style="color: #000000"> = </span><span style="color: #267F99">any</span><span style="color: #000000">&gt;(</span></div><div class='line'><span style="color: #000000">  </span><span style="color: #001080"><data-lsp lsp='(parameter) Page: React.ComponentType&lt;TProps> | BlitzPage&lt;TProps>' >Page</data-lsp></span><span style="color: #000000">: </span><span style="color: #267F99"><data-lsp lsp='(alias) type ComponentType&lt;P = {}> = ComponentClass&lt;P, any> | FunctionComponent&lt;P>&#10;import ComponentType' >ComponentType</data-lsp></span><span style="color: #000000">&lt;</span><span style="color: #267F99"><data-lsp lsp='(type parameter) TProps in withCustomProvider&lt;TProps = any>(Page: React.ComponentType&lt;TProps> | BlitzPage&lt;TProps>): {&#10;    (props: ComponentProps&lt;any>): JSX.Element;&#10;    displayName: string;&#10;}' >TProps</data-lsp></span><span style="color: #000000">&gt; | </span><span style="color: #267F99"><data-lsp lsp='(alias) type BlitzPage&lt;P = {}> = React.ComponentType&lt;P> &amp; {&#10;    getLayout?: ((component: JSX.Element) => JSX.Element) | undefined;&#10;    authenticate?: boolean | {&#10;        redirectTo?: string | RouteUrlObject | undefined;&#10;        role?: string | ... 1 more ... | undefined;&#10;    } | undefined;&#10;    suppressFirstRenderFlicker?: boolean | undefined;&#10;    redirectAuthenticatedTo?: RedirectAuthenticatedTo | ... 1 more ... | undefined;&#10;}&#10;import BlitzPage' >BlitzPage</data-lsp></span><span style="color: #000000">&lt;</span><span style="color: #267F99"><data-lsp lsp='(type parameter) TProps in withCustomProvider&lt;TProps = any>(Page: React.ComponentType&lt;TProps> | BlitzPage&lt;TProps>): {&#10;    (props: ComponentProps&lt;any>): JSX.Element;&#10;    displayName: string;&#10;}' >TProps</data-lsp></span><span style="color: #000000">&gt;</span></div><div class='line'><span style="color: #000000">) {</span></div><div class='line'><span style="color: #000000">  </span><span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #795E26"><data-lsp lsp='const CustomProviderRoot: {&#10;    (props: ComponentProps&lt;any>): JSX.Element;&#10;    displayName: string;&#10;}' >CustomProviderRoot</data-lsp></span><span style="color: #000000"> = (</span><span style="color: #001080"><data-lsp lsp='(parameter) props: any' >props</data-lsp></span><span style="color: #000000">: </span><span style="color: #267F99"><data-lsp lsp='(alias) type ComponentProps&lt;T extends keyof JSX.IntrinsicElements | import("/home/siddharth/Documents/GitHub/siddhsuresh-blitz/node_modules/@types/react/index.d.ts").JSXElementConstructor&lt;any>> = T extends JSXElementConstructor&lt;infer P> ? P : T extends keyof JSX.IntrinsicElements ? JSX.IntrinsicElements[T] : {}&#10;import ComponentProps' >ComponentProps</data-lsp></span><span style="color: #000000">&lt;</span><span style="color: #267F99">any</span><span style="color: #000000">&gt;) </span><span style="color: #0000FF">=&gt;</span><span style="color: #000000"> {</span></div><div class='line'><span style="color: #000000">    </span><span style="color: #008000">// ... custom root component</span></div><div class='line'><span style="color: #000000">    </span><span style="color: #AF00DB">return</span><span style="color: #000000"> </span><span style="color: #800000">&lt;</span><span style="color: #267F99"><data-lsp lsp='(parameter) Page: React.ComponentType&lt;TProps> | BlitzPage&lt;TProps>' >Page</data-lsp></span><span style="color: #000000"> </span><span style="color: #0000FF">{</span><span style="color: #000000">...</span><span style="color: #001080"><data-lsp lsp='(parameter) props: any' >props</data-lsp></span><span style="color: #0000FF">}</span><span style="color: #000000"> </span><span style="color: #800000">/&gt;</span></div><div class='line'><span style="color: #000000">  }</span></div><div class='line'><span style="color: #000000">  </span><span style="color: #AF00DB">if</span><span style="color: #000000"> (</span><span style="color: #001080"><data-lsp lsp='var process: NodeJS.Process' >process</data-lsp></span><span style="color: #000000">.</span><span style="color: #001080"><data-lsp lsp='(property) NodeJS.Process.env: NodeJS.ProcessEnv' >env</data-lsp></span><span style="color: #000000">.</span><span style="color: #0070C1"><data-lsp lsp='(property) NodeJS.ProcessEnv.NODE_ENV: "development" | "production" | "test"' >NODE_ENV</data-lsp></span><span style="color: #000000"> !== </span><span style="color: #A31515">"production"</span><span style="color: #000000">) {</span></div><div class='line'><span style="color: #000000">    </span><span style="color: #001080"><data-lsp lsp='const CustomProviderRoot: {&#10;    (props: ComponentProps&lt;any>): JSX.Element;&#10;    displayName: string;&#10;}' >CustomProviderRoot</data-lsp></span><span style="color: #000000">.</span><span style="color: #001080"><data-lsp lsp='(property) CustomProviderRoot.displayName: string' >displayName</data-lsp></span><span style="color: #000000"> = </span><span style="color: #A31515">`CustomProviderRoot`</span></div><div class='line'><span style="color: #000000">  }</span></div><div class='line'><span style="color: #000000">  </span><span style="color: #AF00DB">return</span><span style="color: #000000"> </span><span style="color: #001080"><data-lsp lsp='const CustomProviderRoot: {&#10;    (props: ComponentProps&lt;any>): JSX.Element;&#10;    displayName: string;&#10;}' >CustomProviderRoot</data-lsp></span></div><div class='line'><span style="color: #000000">}</span></div><div class='line'>&nbsp;</div><div class='line'><span style="color: #AF00DB">export</span><span style="color: #000000"> </span><span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1"><data-lsp lsp='const BlitzCustomPlugin: (options: CustomPluginOptions) => ClientPlugin&lt;{}>' >BlitzCustomPlugin</data-lsp></span><span style="color: #000000"> = </span><span style="color: #001080"><data-lsp lsp='(alias) createClientPlugin&lt;CustomPluginOptions, {}>(pluginConstructor: (options: CustomPluginOptions) => ClientPlugin&lt;{}>): (options: CustomPluginOptions) => ClientPlugin&lt;...>&#10;import createClientPlugin' >createClientPlugin</data-lsp></span><span style="color: #000000">&lt;</span></div><div class='line'><span style="color: #000000">  </span><span style="color: #001080"><data-lsp lsp='type CustomPluginOptions = {}' >CustomPluginOptions</data-lsp></span><span style="color: #000000">,</span></div><div class='line'><span style="color: #000000">  {}</span></div><div class='line'><span style="color: #000000">&gt;((</span><span style="color: #001080"><data-lsp lsp='(parameter) options: CustomPluginOptions | undefined' >options</data-lsp></span><span style="color: #000000">?: </span><span style="color: #267F99"><data-lsp lsp='type CustomPluginOptions = {}' >CustomPluginOptions</data-lsp></span><span style="color: #000000">) </span><span style="color: #0000FF">=&gt;</span><span style="color: #000000"> {</span></div><div class='line'><span style="color: #000000">  </span><span style="color: #008000">// ... plugin code</span></div><div class='line'><span style="color: #000000">  </span><span style="color: #AF00DB">return</span><span style="color: #000000"> {</span></div><div class='line'><span style="color: #000000">    </span><span style="color: #001080"><data-lsp lsp='(property) ClientPlugin&lt;{}>.events: EventHooks' >events</data-lsp>:</span><span style="color: #000000"> {</span></div><div class='line'><span style="color: #000000">      </span><span style="color: #795E26"><data-lsp lsp='(property) onSessionCreated?: OnSessionCreated | undefined' >onSessionCreated</data-lsp></span><span style="color: #001080">:</span><span style="color: #000000"> </span><span style="color: #0000FF">async</span><span style="color: #000000"> () </span><span style="color: #0000FF">=&gt;</span><span style="color: #000000"> {</span></div><div class='line'><span style="color: #000000">        </span><span style="color: #008000">// Called when a new session is created</span></div><div class='line'><span style="color: #000000">        </span><span style="color: #008000">// Usually when the user logs in or logs out</span></div><div class='line'><span style="color: #000000">      },</span></div><div class='line'><span style="color: #000000">      </span><span style="color: #795E26"><data-lsp lsp='(property) onRpcError?: OnRpcError | undefined' >onRpcError</data-lsp></span><span style="color: #001080">:</span><span style="color: #000000"> </span><span style="color: #0000FF">async</span><span style="color: #000000"> (</span><span style="color: #001080"><data-lsp lsp='(parameter) error: Error' >error</data-lsp></span><span style="color: #000000">) </span><span style="color: #0000FF">=&gt;</span><span style="color: #000000"> {</span></div><div class='line'><span style="color: #000000">        </span><span style="color: #008000">// Called when an RPC call fails</span></div><div class='line'><span style="color: #000000">      },</span></div><div class='line'><span style="color: #000000">    },</span></div><div class='line'><span style="color: #000000">    </span><span style="color: #001080"><data-lsp lsp='(property) ClientPlugin&lt;{}>.middleware: MiddlewareHooks' >middleware</data-lsp>:</span><span style="color: #000000"> {</span></div><div class='line'><span style="color: #000000">      </span><span style="color: #795E26"><data-lsp lsp='(property) beforeHttpRequest?: BeforeHttpRequest | undefined' >beforeHttpRequest</data-lsp></span><span style="color: #001080">:</span><span style="color: #000000"> (</span><span style="color: #001080"><data-lsp lsp='(parameter) req: RequestInit' >req</data-lsp></span><span style="color: #000000">) </span><span style="color: #0000FF">=&gt;</span><span style="color: #000000"> {</span></div><div class='line'><span style="color: #000000">        </span><span style="color: #008000">//make changes to the request options before RPC call</span></div><div class='line'><span style="color: #000000">        </span><span style="color: #AF00DB">return</span><span style="color: #000000"> </span><span style="color: #001080"><data-lsp lsp='(parameter) req: RequestInit' >req</data-lsp></span></div><div class='line'><span style="color: #000000">      },</span></div><div class='line'><span style="color: #000000">      </span><span style="color: #795E26"><data-lsp lsp='(property) beforeHttpResponse?: BeforeHttpResponse | undefined' >beforeHttpResponse</data-lsp></span><span style="color: #001080">:</span><span style="color: #000000"> (</span><span style="color: #001080"><data-lsp lsp='(parameter) res: Response' >res</data-lsp></span><span style="color: #000000">) </span><span style="color: #0000FF">=&gt;</span><span style="color: #000000"> {</span></div><div class='line'><span style="color: #000000">        </span><span style="color: #008000">//make changes to the response before returning to the caller</span></div><div class='line'><span style="color: #000000">        </span><span style="color: #AF00DB">return</span><span style="color: #000000"> </span><span style="color: #001080"><data-lsp lsp='(parameter) res: Response' >res</data-lsp></span></div><div class='line'><span style="color: #000000">      },</span></div><div class='line'><span style="color: #000000">    },</span></div><div class='line'><span style="color: #000000">    </span><span style="color: #795E26"><data-lsp lsp='(property) ClientPlugin&lt;{}>.exports: () => {}' >exports</data-lsp></span><span style="color: #001080">:</span><span style="color: #000000"> () </span><span style="color: #0000FF">=&gt;</span><span style="color: #000000"> ({</span></div><div class='line'><span style="color: #000000">      </span><span style="color: #008000">// ... plugin exports</span></div><div class='line'><span style="color: #000000">    }),</span></div><div class='line'><span style="color: #000000">    </span><span style="color: #001080"><data-lsp lsp='(property) ClientPlugin&lt;{}>.withProvider?: BlitzProviderComponentType | undefined' >withProvider</data-lsp>:</span><span style="color: #000000"> </span><span style="color: #001080"><data-lsp lsp='function withCustomProvider&lt;TProps = any>(Page: React.ComponentType&lt;TProps> | BlitzPage&lt;TProps>): {&#10;    (props: ComponentProps&lt;any>): JSX.Element;&#10;    displayName: string;&#10;}' >withCustomProvider</data-lsp></span><span style="color: #000000">,</span></div><div class='line'><span style="color: #000000">  }</span></div><div class='line'><span style="color: #000000">})</span></div></code></div></pre>